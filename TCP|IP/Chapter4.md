## Chapter4 IPプロトコル

### IPはインターネット層のプロトコル

- TCP/IPのインターネット層は主にIP(Internet Protocol)とICMP(Internet Control Message Protocol)の２つのプロトコルから構成されている。またIPの新しいバージョンとしてIPv6(IP version 6)がある

#### IPはOSI参照モデルの第３層に相当

- ネットワーク層の役割は「終点ノード間の通信を実現する（エンドツーエンド）」である
- データリンク層では、同じ種類のデータリンクだけで接続されているノード間のパケット転送を行うが、ネットワーク層では異なる種類のデータリンクであっても連携をとりながらパケットを配送することができる

**ホストとノード**

- インターネットの世界では、IPアドレスがつけられた機器を「ホスト」という。
- 「ホスト」はIPアドレスはつけられているが、経路制御を行わない機器という意味でもある。経路制御を行う場合「ルーター」と呼び、その２つを合わせると「ノード」となる

#### ネットワーク層とデータリンク層の関係

- 旅行する場合を例とすると、飛行機や電車、バスなどを乗り継いで行く時、その区間をデータリンク、その切符や航空券がプロトコル、旅行の工程表がネットワーク層に当たる
- 工程表だけでは乗り物に乗れず、目的地には行けない。逆に、切符だけでは目的地がわからないので行けない

![IPの役割とデータリンクの役割](https://raw.githubusercontent.com/shinzanmono/Markdown/07e943317bc5ae719ef7a82c7d9d061bdc6a1782/images/datalink-and-ip.drawio.svg)

### IPの基礎知識

- IPには大きく３つの役割がある。IPアドレス、終点ホストまでのパケット配送（ルーティング）、IPパケットの分割処理と再構築処理

#### IPアドレスはネットワーク層のアドレス

- IPアドレスは「ネットワークに接続されているすべてのホストの中から、通信を行う宛先を識別する」時に使用される。
- 形式は、データリンクに左右されず、全く同じものが使われる。
- ブリッジやスイッチングハブなど、物理層やデータリンク層でパケットを中継する機器には、IPアドレスは不要

#### 経路制御（ルーティング）

- ルーティングは「宛先IPアドレスのホストまでパケットを届けるための機能」である

**最終的な宛先ホストまでのパケット配送**

- TCP/IPではホップ(hop)という単位があり、ネットワークの1区間のことをいう。IPの経路制御はホップバイホップルーティングという方式で行われる
- ホップバイルーティングでのルーターやホストは、IPパケットの転送先となるルーターやホストを支持するだけで、最終目的地までの経路を指示するわけではない
- まず1区間までの場所まで移動し、そこで目的地までの道を聞く。これを繰り返して目的地まで向かう。
- この時の目的地まで向かう人がIPパケット、区間での道を教える人がルーター、移動体がデータリンクとなる

**１ホップの範囲**

- １ホップはデータリンク層以下の機能だけを使ってフレームが伝送される1区間を意味する

**経路制御表（ルーティングテーブル）**

- 宛先のホストまでパケットを送るため、すべてのホストやルーターは経路制御表と呼ばれる情報を持っている。この表にはIPパケットを次にどのルーターへ送ればよいかが記されている

