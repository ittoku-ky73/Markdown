## Chapter5 IPに関連する技術

### IPだけでは通信できない

- この章ではIPを補助するDNS, ARP, ICMP, ICMPv6, DHCP, NATについて説明する。さらに、IPトンネリング、IPマルチキャスト、IPエニーキャスト、品質制御（QoS）、明示的なふくそう通知、Mobile IPについても説明する

- Webや電子メールを使うときは、IPアドレスではなく、Webサイトのアドレスや電子メールアドレスなど、アプリケーション層で決められているアドレスを使う。しかし実際に通信するにはIPアドレスが必要

### DNS(Domain Name System)

- DNSは、ローマ字とピリオドを使った名前からIPアドレスへと自動的に変換する。IPv4, IPv6で使われる

#### IPアドレスを覚えるのは大変

- ユーザーがアプリケーションを利用するときに通信相手をIPアドレスで直接指定するのはとても不便。また、数字の羅列（IPアドレス）よりも英文字列（DNS）の方が覚えやすい
- TCP/IPの世界では古くからホスト名と呼ばれるコンピュータに名前をつけてIPアドレスではなくホスト名で通信する方法が利用されていた。この機能を実現するために、ホスト名とIPアドレスの対応を定義するhostsと呼ばれるデータベースファイルが利用されていた
- ARPANETでは、hostsファイルをネットワークインフォメーションセンター（SRI-NIC）で一括管理されていた。ARPANETにコンピュータが接続されたり、IPアドレスが変更されたりしたときにはセンターのデータベースが更新され、他のコンピュータは定期的にセンターからデータベースをダウンロードしながら運用していた。
- これは、ネットワークの規模が大きくなり、接続するコンピュータが増えるとホスト名やIPアドレスの登録・変更処理を１ヶ所で管理するのは不可能になる

#### DNSの登場

- ホスト名とIPアドレスの対応関係を効率よく管理するためにDNSが考えられた。これは組織内でホスト名とIPアドレスの関係を表すデータベースを管理することができる方法。
- 現在ユーザーがWebブラウザなどのアプリケーションを利用するときにホスト名を入力するだけで通信できるのは、DNSのお陰

#### ドメイン名の構造

- 倉敷芸術学大学(`kusa.ac.jp`)を例にすると、`kusa`が固有のドメイン名を表し、`ac`が大学(academy)や高専、専門学校などの高等教育機関を、`jp`が日本を表している。
- ドメインを使用した場合には、それぞれのホスト名の後にその組織のドメイン名をつける。例えば、`www.kusa.ac.jp`, `piyo.kusa.ac.jp`, `kinoko.kusa.ac.jp`のようにつける
- DNSは木構造となっている（木をひっくり返したような構造）。`jp`ドメインの下には以下のような種類がある。

| jpより下の第２レベルドメイン | 意味                               |
| ---------------------------- | ---------------------------------- |
| ac                           | 大学                               |
| co                           | 企業                               |
| ed                           | 学校（幼稚園、小中学校、各種学校） |
| go                           | 政府機関                           |
| cr                           | 法人（財団法人、社団法人）         |
| ne                           | ネットワークサービスの提供組織     |
| gr                           | 法人資格を持たない任意団体、個人   |
| ad                           | JPNICの会員                        |
| lg                           | 地域公共団体                       |
| tokyo, osakaなど             | 地域ドメイン                       |
| netone, naistなど            | 汎用ドメイン                       |

**ネームサーバー**

- ドメイン名を管理しているホストやソフトウェアのこと。設置された階層のドメインに関する情報を管理している。その管理する階層のことをゾーンという
- ルートの部分に設置されているサーバーをルートネームサーバーという。jpやorgなどを管理しているネームサーバーのIPアドレスが登録されている。
- また、DNSのプロトコル的制約により、ルートネームサーバーは13個のIPアドレスで表現され、AからMまでの名称がついている。そして負荷分散や対故障性の向上のため、IPエニーキャストによりサーバーの台数を増やしている
- ネームサーバがダウンしてしまうと、そのドメインに対するDNSの問い合わせに対応できなくなる。このため、耐障害性を向上させるために2つ以上のネームサーバーを設置することになっている
- ルートネームサーバーのIPアドレスの最新情報：https://www.internic.net/zones/named.root

**リゾルバ(Resolver)**

- DNSに問い合わせを行うホストやソフトウェアのこと。

#### DNSによる問い合わせ

![DNSによる問い合わせ](https://raw.githubusercontent.com/shinzanmono/Markdown/3081dab374c534b267cbcf7c3233cb87d2313e97/images/DNS-query.drawio.svg)

#### DNSはインターネットに広がる分散データ

- DNSは、ホスト名とIPアドレスの管理以外にも様々な情報を管理している。

| タイプ | 番号 | 内容                                   |
| ------ | ---- | -------------------------------------- |
| A      | 1    | ホストのIPアドレス（IPv4)              |
| NS     | 2    | ネームサーバー                         |
| CNAME  | 5    | ホストの別名に対する正式名             |
| SOA    | 6    | ゾーン内の登録データの開始マーク       |
| WKS    | 11   | ウェルノウンサービス                   |
| PTR    | 12   | IPアドレスの逆引き用のポインタ         |
| HINFO  | 14   | メールボックスやメーリングリストの情報 |
| MX     | 15   | メールサーバー(Mail Exchange)          |
| TXT    | 16   | テキスト文字列                         |
| SIG    | 24   | セキュリティの署名                     |
| KEY    | 25   | セキュリティの鍵                       |
| GPOS   | 27   | 地理的な位置                           |
| AAAA   | 28   | ホストのIPv6アドレス                   |
| NXT    | 30   | 次のドメイン                           |
| SRV    | 33   | サーバーの選択                         |
| *      | 255  | すべてのレコードの要求                 |

